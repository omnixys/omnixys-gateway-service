name: Deploy Omnixys Service

on:
  push:
    branches: [main]

env:
      SERVICE: ${{ secrets.SERVICE }}

jobs:
  deploy:
    runs-on: [self-hosted, omnixys-prod]
    concurrency:
      group: omnixys-prod
      cancel-in-progress: false
    
    steps:
      - name: Deploy ${{ env.SERVICE }}
        run: |
          set -e
          cd /opt/omnixys/compose

          echo "ðŸš€ Deploying service: $SERVICE"
          docker compose pull "$SERVICE"
          docker compose up -d "$SERVICE"
